### 说明

之前项目花了很久的功夫，从传统的主机部署迁移至公司的私有paas平台，利用docker全部搞成容器化部署了，但是19年 9、10 、11连续三个月，月初第一天出账的时候，后台进程批量僵尸，导致大批量的用户停复机、补换卡出现问题，查了很久，猜测可能是redhat内核版本与docker版本不兼容，在机器负载过大时会出现异常，当时客户侧也不给时间说升级内核了，因为但是还会出相同的问题，所以直接下需求过来，说是由docker再迁移回传统主机直接部署的方式。



那么问题就来了，生产环境我们一共用了65台16C32G的机器，怎么才能批量发布，启动，停止呢，嘿嘿，ansible是真好用。

这个项目就是当时使用ansible，结合shell写的批量发包，灰度发布的脚本，到现在为止好像还没出过任何事故，记录下来，回头万一再写就不用重头再来一遍了。



介绍一下项目目录结构：

* hosts文件是/etc/ansible/hosts 文件，从生产上复制下来的。
* command 是发布机上的一些封装好的基于ansible的操作。
* others  是部署在计算主机上的启动，停止脚本。